<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filter NestWatch Data on Finer Scales • nestwatchR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filter NestWatch Data on Finer Scales">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nestwatchR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.100</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/a_Intro-and-Data-Access.html">Introduction to NestWatch Data and Data Access</a></li>
    <li><a class="dropdown-item" href="../articles/b_Data-Cleaning.html">Conduct Common NestWatch Data Cleaning Procedures</a></li>
    <li><a class="dropdown-item" href="../articles/c_Data-Estimation.html">Estimate NestWatch Summary Dates</a></li>
    <li><a class="dropdown-item" href="../articles/d_Data-Filtering.html">Filter NestWatch Data on Finer Scales</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Function Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/engagement-center/nestwatchR/" aria-label="github"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filter NestWatch Data on Finer Scales</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/engagement-center/nestwatchR/blob/HEAD/vignettes/d_Data-Filtering.Rmd" class="external-link"><code>vignettes/d_Data-Filtering.Rmd</code></a></small>
      <div class="d-none name"><code>d_Data-Filtering.Rmd</code></div>
    </div>

    
    
<p>Before analysis, researchers should consider conducting finer-scale
filtering in order to clean the NestWatch dataset after running <a href="https://engagement-center.github.io/nestwatchR/reference/nw.cleandata.html"><code>nw.cleandata()</code></a>.
This may include selecting certain species, identifying specific nest
phenology dates (i.e., incubation should not last longer than X days for
species Y), or limiting nest attempts to a certain geographic area.</p>
<p><br></p>
<div class="section level2">
<h2 id="filtering-species">Filtering Species<a class="anchor" aria-label="anchor" href="#filtering-species"></a>
</h2>
<p>Limiting the dataset to just a few species can easily be done using
the pipe (<code>%&gt;%</code>). If you are unfamiliar with “piping”, see
the <a href="https://magrittr.tidyverse.org/" class="external-link"><code>migritrr</code></a>
package. Below we will subset the version 1 of the NestWatch dataset to
include only attempts for Bewick’s Wren (“bewwre”) and Carolina Wren
(“carwre”). The code below walks through download, merging, and
filtering to species from scratch.</p>
<p>Note that subspecies and identifiable forms of species have different
species codes than the main species. For example, Carolina Wren’s
species code is “carwre” but Carolina Wren (Northern) has the code
“carwre1”. If you wish to include all subspecies/forms, make sure to run
<code>nw.cleantaxa(data = data, rollsubspecies = T)</code> or lookup the
species codes you would like to include by referencing the eBird
taxonomy table using auk::ebird_taxonomy.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(nestwatchR)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># Download and merge datasets</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">nw.getdata</span>(<span class="at">version =</span> <span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">nw.mergedata</span>(<span class="at">attempts =</span> NW.attempts, <span class="at">checks =</span> NW.checks, <span class="at">output =</span> <span class="st">"merged.data"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co"># Filter data to include only carwre and bewwre</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>wrens <span class="ot">&lt;-</span> merged.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Species.Code <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"carwre"</span>, <span class="st">"bewwre"</span>))</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co"># View what species are in the new dataset</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="fu">unique</span>(wrens<span class="sc">$</span>Species.Name)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="sc">&gt;</span> [<span class="dv">1</span>] <span class="st">"Carolina Wren"</span> <span class="st">"Bewick's Wren"</span></span></code></pre></div>
<p><br> This “wrens” data subset from dataset Version 1 is also included
within the package for quick access using
<code>wrens &lt;- nestwatchR::wren_quickstart</code>:</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="filter-spatially">Filter Spatially<a class="anchor" aria-label="anchor" href="#filter-spatially"></a>
</h2>
<p>Spatial filters are a flexible way to limit data to a predefined
geographic area. You may choose to limit an analysis to nesting attempts
within a certain area, like a single <a href="https://nabci-us.org/resources/bird-conservation-regions-map/" class="external-link">Bird
Conservation Region</a> or a select political jurisdiction. Or you may
choose to remove potentially misidentified species by using a range map
to filter out nesting attempts. If those filtering criteria are easily
subset from the dataset, like states/provinces and countries (via
<code>Subnational.Code</code>), you can quickly use subsetting rules to
filter the data for analysis. But, if those criteria are not already
easily subset-able, a spatial filter can be a good option.</p>
<p>As an example, we can first view a plot of where the nests in
<code>wrens</code> are located by species. Here we will use the package
<a href="https://cran.r-project.org/web/packages/tmap/vignettes/tmap-getstarted.html" class="external-link"><code>tmap</code></a>
to produce an interactive map. We will also be utilizing the <a href="https://r-spatial.github.io/sf/" class="external-link"><code>sf</code></a> package to
help create and transform our tabular data into spatial data. We will
then project the wrens data into the Lambert Conformal Conic Projection,
which is well suited for mapping areas in the United States (but you can
change the object <code>proj</code> to any appropriate PROJ.4 string for
the area you are mapping).</p>
<p>[!Note] If you are unfamiliar with working with spatial data, <a href="https://bookdown.org/mcwimberly/gdswr-book/coordinate-reference-systems.html" class="external-link">this
is a good resource</a> on coordinate reference systems and projections
within R.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a spatial object from nest data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">nest_points</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">wrens</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span>  <span class="co"># data are in WGS 84 (crs = 4326)</span></span>
<span></span>
<span><span class="co"># Define desired CRS for data projection</span></span>
<span><span class="va">proj</span> <span class="op">&lt;-</span> <span class="st">"+proj=lcc +lon_0=-90 +lat_1=33 +lat_2=45"</span>  <span class="co"># PROJ.4 string defining the projection</span></span>
<span>  </span>
<span><span class="co"># Project the nest points into LCC projection  </span></span>
<span><span class="va">nest_points</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nest_points</span>, crs <span class="op">=</span> <span class="va">proj</span><span class="op">)</span>   <span class="co"># apply projection</span></span>
<span></span>
<span><span class="co"># Map nest locations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html" class="external-link">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span>                                             <span class="co"># starts interactive plot</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_basemap.html" class="external-link">tm_basemap</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op">+</span>                   <span class="co"># define basemap</span></span>
<span>       <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">nest_points</span><span class="op">)</span> <span class="op">+</span>                                <span class="co"># add nest point data</span></span>
<span>          <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Species.Name"</span>,                       <span class="co"># color nests by species</span></span>
<span>                  palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#457999"</span>, <span class="st">"#8DCA8B"</span><span class="op">)</span>,</span>
<span>                  border.col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the map</span></span>
<span><span class="va">map</span>                                                           </span></code></pre></div>
<div class="float">
<img src="wren-nests.png" alt="Map of the United States overlayed with points representing Bewick’s Wren (blue) and Carolina Wren (green) nest locations."><div class="figcaption">Map of the United States overlayed with points
representing Bewick’s Wren (blue) and Carolina Wren (green) nest
locations.</div>
</div>
<p>By looking at this map, we can see that there are several suspicious
nests identified as Bewick’s Wrens in the eastern United States.
Bewick’s Wrens are not typically recorded east of the Mississippi River,
so some of these records could be misidentified. We could decide on a
subset of states/provinces to filter out-of-range nest attempts, but a
better method might be to filter nest locations based on a range
map.</p>
<div class="section level3">
<h3 id="ebird-range-map-polygons">eBird Range Map Polygons<a class="anchor" aria-label="anchor" href="#ebird-range-map-polygons"></a>
</h3>
<p>The <a href="https://science.ebird.org/en/status-and-trends" class="external-link">eBird
Status and Trends Products</a> contain a wealth of information on bird
populations. Among the available products are range maps of species for
which Status and Trend Models have been run. These data are easily
accessible in R through the <a href="https://ebird.github.io/ebirdst/" class="external-link"><code>ebirdst</code></a>
package. To access these eBird data, you will need to acquire a free
access key. This key will give you access to Status and Trends Data
within R. For more information and to acquire an access key, see the <a href="https://ebird.github.io/ebirdst/" class="external-link">documentation here</a>.</p>
<p>We can use our unique access key to download the range map of
Bewick’s Wren and Carolina Wren. Note, you will need the 6-letter
species codes of those species you would like to download, not their
alpha code or common name. By modifying the access key, species, and
download location in the code below, you can download and open the range
polygons to your global environment. This code selects only the breeding
range layer if available, and if unavailable then selects the resident
range layer. Note: You only need to input your access key once (R will
store it for you!) and you only need to download the range maps once
(you may get an error if you rerun <a href="https://ebird.github.io/ebirdst/reference/ebirdst_download_status.html" class="external-link"><code>ebirdst_download_status()</code></a>
when the data already exists at the <code>spatialdata_path</code>
location). You may also need to modify the year in the code below
depending on what Status &amp; Trends data product is available.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Obtain and set an ebird access key</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ebird.github.io/ebirdst/" class="external-link">ebirdst</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ebird.github.io/ebirdst/reference/set_ebirdst_access_key.html" class="external-link">set_ebirdst_access_key</a></span><span class="op">(</span><span class="st">"pasteyourkeyhere"</span><span class="op">)</span>      <span class="co"># you only need to do this once, R will remember it</span></span>
<span></span>
<span><span class="co"># Define what species you want to download by their 6-letter code</span></span>
<span><span class="va">spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bewwre"</span>, <span class="st">"carwre"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify where the data will be downloaded</span></span>
<span><span class="co"># Here we will reference a folder called "spatial" in our working directory:</span></span>
<span><span class="va">spatialdata_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spatial"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="co"># Download range maps by species</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">spp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ebird.github.io/ebirdst/reference/ebirdst_download_status.html" class="external-link">ebirdst_download_status</a></span><span class="op">(</span>species <span class="op">=</span> <span class="va">i</span>, download_abundance <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                          download_ranges <span class="op">=</span> <span class="cn">TRUE</span>, pattern <span class="op">=</span> <span class="st">"_smooth_27km_"</span>, </span>
<span>                          path <span class="op">=</span> <span class="va">spatialdata_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># You may need to modify the year below to reflect the appropriate S&amp;T product that downloaded</span></span>
<span><span class="co"># Read in the range files</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">spp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Generate the path to the .gpkg files</span></span>
<span>  <span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">spatialdata_path</span>, <span class="st">"/2022/"</span>, <span class="va">i</span>, <span class="st">"/ranges/"</span>, <span class="va">i</span>, <span class="st">"_range_smooth_27km_2022.gpkg"</span><span class="op">)</span></span>
<span>  <span class="co"># Read in the .gpkg file</span></span>
<span>  <span class="va">range_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span>
<span>  <span class="co"># Generate the name for the object</span></span>
<span>  <span class="va">object_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span>, <span class="st">"_range"</span><span class="op">)</span></span>
<span>  <span class="co"># Assign the value to the dynamically-generated object name</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">object_name</span>, <span class="va">range_data</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">range_data</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Select just breeding layer if available, else resident layer</span></span>
<span><span class="va">object_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">spp</span>, <span class="st">"range"</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">object_names</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span>envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">i</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">season</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"breeding"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"breeding"</span><span class="op">)</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nest_points</span>, crs <span class="op">=</span> <span class="va">proj</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, <span class="va">data</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">season</span> <span class="op">==</span> <span class="st">"resident"</span><span class="op">)</span></span>
<span>      <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">nest_points</span>, crs <span class="op">=</span> <span class="va">proj</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">i</span><span class="op">)</span>, <span class="va">data</span>, envir <span class="op">=</span> <span class="va">.GlobalEnv</span><span class="op">)</span><span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Clean up intermediate objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">file_path</span>, <span class="va">i</span>, <span class="va">object_name</span>, <span class="va">object_names</span>, <span class="va">spatialdata_path</span><span class="op">)</span></span></code></pre></div>
<p><br> Now that we have range polygons for Bewick’s Wrens and Carolina
Wrens, we can add them to our map and investigate our nest locations a
bit closer. Let’s plot just the Bewick’s Wren data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Subset nest locations to Bewick's Wrens</span></span>
<span><span class="va">bewwre</span> <span class="op">&lt;-</span> <span class="va">nest_points</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species.Code</span> <span class="op">==</span> <span class="st">"bewwre"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Map the nests onto the range polygon</span></span>
<span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tmap_mode.html" class="external-link">tmap_mode</a></span><span class="op">(</span><span class="st">"view"</span><span class="op">)</span>                                           <span class="co"># starts interactive plot</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_basemap.html" class="external-link">tm_basemap</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op">+</span>                 <span class="co"># define basemap</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span>shp <span class="op">=</span> <span class="va">bewwre_range</span>, name <span class="op">=</span> <span class="st">"Bewick's Wren"</span><span class="op">)</span> <span class="op">+</span>    <span class="co"># add range polygon, </span></span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span>                col <span class="op">=</span> <span class="st">"#B4CFE1"</span>, border.col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>       <span class="co"># define polygon color      </span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">bewwre</span><span class="op">)</span> <span class="op">+</span>                                        <span class="co"># add nest points</span></span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Species.Name"</span>, </span>
<span>            border.col <span class="op">=</span> <span class="st">"grey90"</span>, palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#457999"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># define nest point color</span></span>
<span><span class="va">map</span></span></code></pre></div>
<div class="float">
<img src="plot-bewwre-data.png" alt="Map of the United States overlayed with a range polygon and points representing the locations of Bewick’s Wren nests. Most nests are within the range polygon, but a few are located outside."><div class="figcaption">Map of the United States overlayed with a range
polygon and points representing the locations of Bewick’s Wren nests.
Most nests are within the range polygon, but a few are located
outside.</div>
</div>
<p><br></p>
<p>We can now see that there are more than a few nests outside of the
typical Bewick’s Wren range. But a few of these nests are also close to
the range border and <em>may</em> truly belong to Bewick’s Wrens. We can
use <a href="https://engagement-center.github.io/nestwatchR/reference/nw.filterspatial.html"><code>nw.filterspatial()</code></a>
to help us identify and/or remove nest attempts outside of the range
polygon (or any other shapefile you may want to filter by).</p>
<p><a href="https://engagement-center.github.io/nestwatchR/reference/nw.filterspatial.html"><code>nw.filterspatial()</code></a>
requires the input of <code>sf</code> objects for <code>points =</code>
and <code>polygon =</code>, representing the nest points to be filtered
and the shapefile by which they are filtered, respectively. The
<code>mode =</code> argument is used to define if points identified
outside the polygon should be flagged for review (“flagged”) or removed
from the dataset (“remove”). This function also has an optional buffer
argument <code>buffer =</code> where the user may define a distance
outside the polygon for which nest locations will be allowed. This
distance can be either in kilometers or miles and should be defined
using <code>buffer_units = "km"</code> or <code>= "mi"</code>. The
resulting buffer polygon may be optionally exported to the global
environment for saving or plotting using the logical
<code>buffer_output = T</code>. The user may also define their desired
projection using <code>proj =</code> and inputting a PROJ.4 string. If a
projection is not provided, then the function will default to the
Lambert Conformal Conic which is well suited for plotting the majority
of NestWatch data at this time. Finally, the optional
<code>output =</code> argument can be used to name the resulting
spatially-cleaned dataframe.</p>
<p>If we zoom in to central Colorado, we can see there are a few
Bewick’s Wren nests just outside the range border.</p>
<div class="float">
<img src="colorado-zoom.png" alt="A zoomed in map of Colorado showing two nest locations not too far outside of the typical range of the Bewick’s Wren."><div class="figcaption">A zoomed in map of Colorado showing two nest
locations not too far outside of the typical range of the Bewick’s
Wren.</div>
</div>
<p>We might choose to keep nests like these in our analysis, because
they could be correctly identified and just a bit outside the typical
range. Let’s define a buffer zone to keep such nests but exclude those
well outside the expected range:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nw.filterspatial.html">nw.filterspatial</a></span><span class="op">(</span>points <span class="op">=</span> <span class="va">bewwre</span>,                    <span class="co"># Bewick's Wren nest points </span></span>
<span>                 polygon <span class="op">=</span> <span class="va">bewwre_range</span>,             <span class="co"># Bewick's Wren range shapefile</span></span>
<span>                 mode <span class="op">=</span> <span class="st">"flag"</span>,                      <span class="co"># flag points outside </span></span>
<span>                 buffer <span class="op">=</span> <span class="fl">50</span>,                        <span class="co"># add a 50km buffer zone</span></span>
<span>                 buffer_units <span class="op">=</span> <span class="st">"km"</span>,                <span class="co"># units = km</span></span>
<span>                 buffer_output <span class="op">=</span> <span class="cn">T</span>,                  <span class="co"># yes, output the buffer polygon</span></span>
<span>                 proj <span class="op">=</span> <span class="st">"+proj=lcc +lon_0=-90 +lat_1=33 +lat_2=45"</span>,   <span class="co"># LCC from above</span></span>
<span>                 output <span class="op">=</span> <span class="st">"flagged_nests"</span><span class="op">)</span>           <span class="co"># define the output name</span></span></code></pre></div>
<p><br> We can plot the results to see which points were flagged for
review (and would be removed if mode was set to “remove”):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Relabel nests within range for nice map symbology</span></span>
<span><span class="va">flagged_nests</span><span class="op">$</span><span class="va">Flagged.Location</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">flagged_nests</span><span class="op">$</span><span class="va">Flagged.Location</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"In-Range"</span></span>
<span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_basemap.html" class="external-link">tm_basemap</a></span><span class="op">(</span><span class="st">"Esri.WorldGrayCanvas"</span><span class="op">)</span> <span class="op">+</span>                 <span class="co"># define basemap</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span>shp <span class="op">=</span> <span class="va">polygon_buffered</span>, name <span class="op">=</span> <span class="st">"50km Buffer"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># add buffered polygon, define color</span></span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"#CEE6F3"</span>, border.col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>                         </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span>shp <span class="op">=</span> <span class="va">bewwre_range</span>, name <span class="op">=</span> <span class="st">"Bewick's Wren Range"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># add range polygon, define color</span></span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"#B4CFE1"</span>, border.col <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>                         </span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">flagged_nests</span><span class="op">)</span> <span class="op">+</span>                                 <span class="co"># add nest points, color by "Flagged.Attempt"</span></span>
<span>    <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_symbols.html" class="external-link">tm_dots</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"Flagged.Location"</span>, </span>
<span>            palette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#B31B1B"</span>, <span class="st">"#457999"</span><span class="op">)</span>,</span>
<span>            border.col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span>    </span>
<span><span class="va">map</span></span></code></pre></div>
<div class="float">
<img src="plot-buffered.png" alt="Map of the United States overlaid with the Bewick’s Wren typical breeding range polygon, plus an added 50km buffer zone (lighter blue). Points represent the reported locations of Bewick’s Wren nests, with those outside the buffer being red while those inside are blue."><div class="figcaption">Map of the United States overlaid with the
Bewick’s Wren typical breeding range polygon, plus an added 50km buffer
zone (lighter blue). Points represent the reported locations of Bewick’s
Wren nests, with those outside the buffer being red while those inside
are blue.</div>
</div>
<p><br></p>
<p>We can now quickly filter out those nests with flagged locations
outside of our defined range.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove flagged attempts</span></span>
<span><span class="va">nests_cleanlocs</span> <span class="op">&lt;-</span> <span class="va">flagged_nests</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flagged.Location</span> <span class="op">==</span> <span class="st">"In-Range"</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="filter-using-nest-phenology">Filter Using Nest Phenology<a class="anchor" aria-label="anchor" href="#filter-using-nest-phenology"></a>
</h2>
<p>You may also choose to refine the coarse phenologic filtering done in
the cleaning process of <a href="https://engagement-center.github.io/nestwatchR/reference/nw.cleandata.html"><code>nw.cleandata()</code></a>.
NestWatch data are known to have some errors where participants either
enter dates incorrectly (i.e., enter the year portion of a date as 2021
in one field and 2020 in the next) or incorrectly continue a nest
attempt when it should be considered a new nest (i.e. nest usurpation or
failure-and-rebuild). As an example of the latter, if a bluebird nest
fails due to predation and the pair renests in the same box, this should
be entered as two different attempts at the same location. But records
of these “run-on nests” where the first attempt was not ended do exist
in the dataset. One way a user might choose to identify or remove such
nesting attempts, or ones which are outside of the expected nesting
timeline for a given species, is to use phenologic filtering.</p>
<p>Phenologic filtering allows the user to define the allowed maximum
number of days for each different period in the nesting cycle, or for
the whole nesting cycle. The function <a href="https://engagement-center.github.io/nestwatchR/reference/nw.filterphenology.html"><code>nw.filterphenology()</code></a>
uses both the data in the attempt summary info (data originating from
the “Attempts” dataset) and the individual visits data (originating from
the “Checks” dataset). Note that NestWatch participants do not always
provide the summary info, but the key dates may be inferred from the
series of nest check data. Because the function uses both summary and
checks data, we highly recommend running the series of estimation
functions provided in the package to estimate summary dates where they
were not specifically provided by the participant (see: <a href="https://engagement-center.github.io/nestwatchR/reference/nw.estclutchsize.html"><code>nw.estclutchsize()</code></a>,
<a href="https://engagement-center.github.io/nestwatchR/reference/nw.estfirstlay.html"><code>nw.estfirstlay()</code></a>,
<a href="https://engagement-center.github.io/nestwatchR/reference/nw.esthatch.html"><code>nw.esthatch()</code></a>,
and <a href="https://engagement-center.github.io/nestwatchR/reference/nw.estfledge.html"><code>nw.estfledge()</code></a>).
Running these estimations can increase the amount of information
available for phenologic filtering.</p>
<p>For this function, a small user-created dataframe in the following
format is needed. These values represent the <em>maximum</em> allowable
number of days a nest of a particular species can be in each nesting
stage. “Total” refers to the maximum number of days from the initiation
of nest building though fledging. In this example we will continue using
NestWatch data for Bewick’s Wren and Carolina Wren:</p>
<p>First, we will load, clean, and estimate missing values:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 1. Load, Clean, &amp; Estimate Data </span></span>
<span></span>
<span><span class="co"># Load the supplied `wrens` dataset</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">nestwatchR</span><span class="fu">::</span><span class="va"><a href="../reference/wren_quickstart.html">wren_quickstart</a></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Attempt.ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 7626</span></span>
<span><span class="co"># &gt; [1] 7626      # number of nesting attempts for Bewick's and Carolina Wren</span></span>
<span></span>
<span><span class="co"># Run cleaning function </span></span>
<span><span class="fu"><a href="../reference/nw.cleandata.html">nw.cleandata</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, </span>
<span>             mode <span class="op">=</span> <span class="st">"remove"</span>, </span>
<span>             methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>, <span class="st">"f"</span>, <span class="st">"g"</span>, <span class="st">"h"</span>, <span class="st">"i"</span>, <span class="st">"j"</span>, <span class="st">"k"</span><span class="op">)</span>,</span>
<span>             output <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># First, run summary date estimation functions:</span></span>
<span><span class="co"># Missing summary data will be estimated, when possible, by using AVERAGE values </span></span>
<span><span class="co"># for the focal species. The dataframe below contains values of the average clutch</span></span>
<span><span class="co"># size, number of eggs laid per day, incubation period (in days), and nestling </span></span>
<span><span class="co"># period (in days) which the estimation functions will use to estimate any missing values.</span></span>
<span><span class="va">avg_phen</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bewwre"</span>, <span class="st">"carwre"</span><span class="op">)</span>,</span>
<span>                       Clutch.Size  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       Eggs.per.Day <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                       Incubation   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">16</span><span class="op">)</span>,</span>
<span>                       Nestling     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/nw.estclutchsize.html">nw.estclutchsize</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, output <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/nw.estfirstlay.html">nw.estfirstlay</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, phenology <span class="op">=</span> <span class="va">avg_phen</span>, output <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/nw.esthatch.html">nw.esthatch</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, phenology <span class="op">=</span> <span class="va">avg_phen</span>, output <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/nw.estfledge.html">nw.estfledge</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, phenology <span class="op">=</span> <span class="va">avg_phen</span>, output <span class="op">=</span> <span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p><br> Now we can create the maximum allowable periods dataframe and
run phenological filtering. Here we choose the maximum values for
incubation, nestling, and total to be the mean value plus several days
to account for allowable variation in length. Again,
<code>total =</code> represents the maximum nesting period, spanning
between first build and fledge. For example here, Bewick’s Wren
typically build nests within 8 days. So we might say max build time is
10 days, and lay + incubation + nestling + build = 60 days:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## 2. Phenologically filter data by limiting dataset to nests with dates within the maximum possible range.</span></span>
<span></span>
<span><span class="co"># Create simple df with maximum allowable # days in each nest phase for Bewick's and Carolina Wrens.</span></span>
<span><span class="co"># You can provide data for a single species or multiple species to be run at the same time.</span></span>
<span><span class="co"># We suggest adding a few days of buffer to average incubation, nesting, and total </span></span>
<span><span class="co"># nesting period lengths. This is your judgement call based on the biology of the focal species.</span></span>
<span><span class="va">max_days</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bewwre"</span>, <span class="st">"carwre"</span><span class="op">)</span>,</span>
<span>             lay <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">6</span><span class="op">)</span>,           <span class="co"># max recorded clutch size for focal species</span></span>
<span>             incubation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>,  <span class="co"># means plus a bit of buffer</span></span>
<span>             nestling <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>,    <span class="co"># means plus a bit of buffer</span></span>
<span>             total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">55</span><span class="op">)</span><span class="op">)</span>       <span class="co"># mean days build to fledge, plus a bit of buffer</span></span>
<span></span>
<span><span class="co"># Filter attempts based on nesting phenology</span></span>
<span><span class="fu"><a href="../reference/nw.filterphenology.html">nw.filterphenology</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                   mode <span class="op">=</span> <span class="st">"flag"</span>, </span>
<span>                   max_phenology <span class="op">=</span> <span class="va">max_days</span>, </span>
<span>                   trim_to_active <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                   output <span class="op">=</span> <span class="st">"flagged_phenology"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># How many attempts were flagged?</span></span>
<span><span class="va">flagged</span> <span class="op">&lt;-</span> <span class="va">flagged_phenology</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flagged.Attempt</span> <span class="op">==</span> <span class="st">"FLAGGED"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">flagged</span><span class="op">$</span><span class="va">Attempt.ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 594</span></span>
<span><span class="co"># &gt; [1] 448       # number of attempts which were flagged</span></span>
<span></span>
<span><span class="co"># How many checks were flagged?</span></span>
<span><span class="va">flagged</span> <span class="op">&lt;-</span> <span class="va">flagged_phenology</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Flagged.Check</span> <span class="op">==</span> <span class="st">"FLAGGED"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">flagged</span><span class="op">$</span><span class="va">Attempt.ID</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 996</span></span>
<span><span class="co"># &gt; [1] 769       # number of checks which were flagged</span></span></code></pre></div>
<p><br></p>
<p>This function also has the logical argument
<code>trim_to_active</code> (used in the above example). This argument
specifies if nest checks before a nest was active (before building
activity, observed eggs, observed young) or after nest fledge/failure
should be noted for flagging or removal. By setting this argument to
<code>TRUE</code>, individual nest checks outside the active period will
be removed if <code>mode = "remove"</code> or noted with a
<code>"FLAGGED"</code> tag in the new <code>Flagged.Check</code> column
for you to manually inspect.</p>
<p><br> We can visualize the distribution of active nesting periods of
Carolina Wrens in our example before and after being filtered and
trimmed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate the unfiltered date span of each nest</span></span>
<span><span class="va">unfiltered</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species.Code</span> <span class="op">==</span> <span class="st">"carwre"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Attempt.ID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Visit.Datetime</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nesting_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span></span>
<span>                            <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Visit.Datetime</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Visit.Datetime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># date span</span></span>
<span></span>
<span><span class="co"># Filter the data from phenology flags, calculate filtered date spans</span></span>
<span><span class="va">filtered</span> <span class="op">&lt;-</span> <span class="va">flagged_phenology</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Attempt.ID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">Visit.Datetime</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Species.Code</span> <span class="op">==</span> <span class="st">"carwre"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Flagged.Attempt</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Flagged.Check</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>                                  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nesting_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">Visit.Datetime</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">Visit.Datetime</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize filtered vs unfiltered date spans</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">unfiltered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nesting_period</span>, fill <span class="op">=</span> <span class="st">"Unfiltered"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"#69A0C2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Unfiltered"</span> <span class="op">=</span> <span class="st">"#457999"</span>, <span class="st">"Filtered"</span> <span class="op">=</span> <span class="st">"#8DCA8B"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Dataset"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">250</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Carolina Wren Nesting Periods"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">55</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">85</span>, y <span class="op">=</span> <span class="fl">4500</span>, label <span class="op">=</span> <span class="st">"55 day limit"</span>, color <span class="op">=</span> <span class="st">"black"</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">filtered</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">nesting_period</span>, fill <span class="op">=</span> <span class="st">"Filtered"</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey90"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Unfiltered"</span> <span class="op">=</span> <span class="st">"#457999"</span>, <span class="st">"Filtered"</span> <span class="op">=</span> <span class="st">"#8DCA8B"</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Dataset"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">250</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Carolina Wren Nesting Periods"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Count"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">55</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html" class="external-link">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">85</span>, y <span class="op">=</span> <span class="fl">4500</span>, label <span class="op">=</span> <span class="st">"55 day limit"</span>, color <span class="op">=</span> <span class="st">"black"</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span></span></code></pre></div>
<p><img src="d_Data-Filtering_files/figure-html/visualize%20filtering-1.png" alt="A histogram displaying the distrubution of nesting periods before and after filtering." width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p2</span></span></code></pre></div>
<p><img src="d_Data-Filtering_files/figure-html/visualize%20filtering-2.png" alt="A histogram displaying the distrubution of nesting periods before and after filtering." width="100%" style="display: block; margin: auto;"></p>
<p>We can see in the unfiltered plot that there were more than a few
nests with long nesting periods before filtering. After filtering out
448 attempts deemed “too long”, we are left with 2,539 attempts to
continue an analysis with. Note that this function does not just trim
the attempts by length. If you look closely you will see the
distribution of nesting periods left of the cutoff has changed slightly
(see the bar directly left of the dashed line has been reduced by
several hundred attempts, and th other bars have increased slightly).
This is due to removing days of nest checks post-fledging from the total
nesting period.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kim Savides, Robyn L. Bailey, David N. Bonter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
